{% extends "template.html" %}

{% load filters %}
{% load wrapwith %}

{% block head %}
  {% include "popup_image.html" %}
{% endblock %}

{% block ptitle %}Task {{ task.id }} : STDWeb{% endblock %}

{% block title %}{{ task.original_name }}{% endblock %}

{% block content %}

  {% if not task %}
    <p>Task not found</p>
  {% else %}

    <p>
      Task {{ task.id }} created by {{ task.user|user }} on {{ task.created|timestamp }}
      <br>
      State: <b>{{ task.state }}</b> on {{ task.modified|timestamp }}
      {% if task.celery_id %}
        <br>
        Queue task: <a href="{% url 'queue' id=task.celery_id %}">{{ task.celery_id }}</a>
      {% endif %}
    </p>

    {% if 'image.fits' in files %}
      {% include "task_block_image.html" with image='image.fits' %}
    {% endif %}

  {% endif %}

  <!-- Management -->
  {% wrapwith "wrapper_management_commands.html" %}
  <form action="" method="POST">
    {% csrf_token %}
    <button type="submit" name="action" value="delete_task" class="btn btn-danger">Delete task</button>
    <button type="submit" name="action" value="inspect_image" class="btn btn-primary">Inspect</button>
  </form>
  {% endwrapwith %}

{% endblock %}
